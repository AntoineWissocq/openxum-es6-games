<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dvonn test</title>
    <link rel="stylesheet" href="qunit-2.6.1.css">
    <script src="qunit-2.6.1.js"></script>
    <script type="module">
        import lib from "/lib/openxum-core/index.mjs";
        window.OpenXum = lib.OpenXum;
    </script>
    <script>
        QUnit.test("coordinates tests", function (assert) {
            let coordinates = new window.OpenXum.Dvonn.Coordinates('A', 1);
            assert.ok(coordinates.letter() === 'A' && coordinates.number() === 1);
        });

        QUnit.test("push test", function (assert) {
            let p = new window.OpenXum.Sixth.Piece({_letter : "A", _number : 1}, 1, 1);
            let list = [];
            list.push(p);

            assert.ok(list.length === 1);
        });

        QUnit.test("_is_empty test", function (assert) {
            let engine = new window.OpenXum.Sixth.Engine(0, 1);
            let p = new window.OpenXum.Sixth.Piece({_letter : "A", _number : 1}, 1, 1);
            let q = new window.OpenXum.Sixth.Piece({_letter : "B", _number : 1}, 1, 1);
            let empty = true;

            engine._tabPiece.push(p);
            engine._tabPiece.push(q);

            //console.log("taille _tabPiece: ", engine._tabPiece.length);

            empty = engine._is_empty({_letter : engine._tabPiece[0]._coordinates._letter, _number : engine._tabPiece[0]._coordinates._number});

            assert.ok(empty == false);
        });

        QUnit.test("move pawn test", function (assert) {

            let engine = new window.OpenXum.Sixth.Engine(0, 1);

            let p = new window.OpenXum.Sixth.Piece({_letter : "B", _number : 2}, 1, 1);
            let q = new window.OpenXum.Sixth.Piece({_letter : "A", _number : 2}, 1, 1);
            let r = new window.OpenXum.Sixth.Piece({_letter : "B", _number : 1}, 1, 1);
            let s = new window.OpenXum.Sixth.Piece({_letter : "C", _number : 2}, 1, 1);
            let t = new window.OpenXum.Sixth.Piece({_letter : "B", _number : 3}, 1, 1);

            engine._tabPiece.push(p);
            engine._tabPiece.push(q);
            engine._tabPiece.push(r);
            engine._tabPiece.push(s);
            engine._tabPiece.push(t);

            //console.log("letter : ", engine._tabPiece);

            let tab = engine._get_possible_moving_list(p);

            //console.log("taille liste: ", tab.length);
            //console.log("contenu : ", tab);


            assert.ok(tab.length === 4);
        });

        QUnit.test("move tower test", function (assert) {

            let engine = new window.OpenXum.Sixth.Engine(0, 1);

            let p = new window.OpenXum.Sixth.Piece({_letter : "C", _number : 3}, 1, 2);
            let q = new window.OpenXum.Sixth.Piece({_letter : "C", _number : 5}, 1, 1);
            let r = new window.OpenXum.Sixth.Piece({_letter : "C", _number : 1}, 1, 1);
            let s = new window.OpenXum.Sixth.Piece({_letter : "A", _number : 3}, 1, 1);
            let t = new window.OpenXum.Sixth.Piece({_letter : "E", _number : 3}, 1, 1);

            engine._tabPiece.push(p);
            engine._tabPiece.push(q);
            engine._tabPiece.push(r);
            engine._tabPiece.push(s);
            engine._tabPiece.push(t);


            let tab = engine._get_possible_moving_list(p);
            //console.log("tabPiece : ", engine._tabPiece);
            //console.log("taille liste: ", tab.length);
            //console.log("contenu :  ", tab);

            assert.ok(tab.length === 4);
        });

        QUnit.test("move knight test", function (assert) {

            let engine = new window.OpenXum.Sixth.Engine(0, 1);

            let p = new window.OpenXum.Sixth.Piece({_letter : "C", _number : 3}, 1, 3);
            let q = new window.OpenXum.Sixth.Piece({_letter : "E", _number : 2}, 1, 1);
            let r = new window.OpenXum.Sixth.Piece({_letter : "E", _number : 4}, 1, 1);
            let s = new window.OpenXum.Sixth.Piece({_letter : "D", _number : 5}, 1, 1);
            let t = new window.OpenXum.Sixth.Piece({_letter : "B", _number : 5}, 1, 1);
            let u = new window.OpenXum.Sixth.Piece({_letter : "A", _number : 4}, 1, 1);
            let v = new window.OpenXum.Sixth.Piece({_letter : "A", _number : 2}, 1, 1);
            let w = new window.OpenXum.Sixth.Piece({_letter : "D", _number : 1}, 1, 1);
            let x = new window.OpenXum.Sixth.Piece({_letter : "B", _number : 1}, 1, 1);
            engine._tabPiece.push(p);
            engine._tabPiece.push(q);
            engine._tabPiece.push(r);
            engine._tabPiece.push(s);
            engine._tabPiece.push(t);
            engine._tabPiece.push(u);
            engine._tabPiece.push(v);
            engine._tabPiece.push(w);
            engine._tabPiece.push(x);



            let tab = engine._get_possible_moving_list(p);



            assert.ok(tab.length === 8);
        });

        QUnit.test("move bishop test", function (assert) {

            let engine = new window.OpenXum.Sixth.Engine(0, 1);

            let p = new window.OpenXum.Sixth.Piece({_letter : "C", _number : 3}, 1, 4);
            let q = new window.OpenXum.Sixth.Piece({_letter : "A", _number : 1}, 1, 1);
            let r = new window.OpenXum.Sixth.Piece({_letter : "A", _number : 5}, 1, 1);
            let s = new window.OpenXum.Sixth.Piece({_letter : "E", _number : 1}, 1, 1);
            let t = new window.OpenXum.Sixth.Piece({_letter : "E", _number : 5}, 1, 1);

            engine._tabPiece.push(p);
            engine._tabPiece.push(q);
            engine._tabPiece.push(r);
            engine._tabPiece.push(s);
            engine._tabPiece.push(t);



            let tab = engine._get_possible_moving_list(p);


            assert.ok(tab.length === 4);
        });


        QUnit.test("move queen test", function (assert) {

            let engine = new window.OpenXum.Sixth.Engine(0, 1);

            let p = new window.OpenXum.Sixth.Piece({_letter : "A", _number : 1}, 1, 5);
            let q = new window.OpenXum.Sixth.Piece({_letter : "E", _number : 1}, 1, 1);
            let r = new window.OpenXum.Sixth.Piece({_letter : "A", _number : 5}, 1, 1);
            let s = new window.OpenXum.Sixth.Piece({_letter : "E", _number : 5}, 1, 1);

            engine._tabPiece.push(p);
            engine._tabPiece.push(q);
            engine._tabPiece.push(r);
            engine._tabPiece.push(s);



            let tab = engine._get_possible_moving_list(p);

            //console.log("taille liste: ", tab.length);
            //console.log("contenu :  ", tab);

            assert.ok(tab.length === 3);
        });

        QUnit.test("move test", function (assert) {

            let engine = new window.OpenXum.Sixth.Engine(0, 1);

            let p = new window.OpenXum.Sixth.Piece({_letter : "A", _number : 1}, 1, 5);
            let q = new window.OpenXum.Sixth.Piece({_letter : "E", _number : 1}, 1, 1);
            //let r = new window.OpenXum.Sixth.Piece({_letter : "A", _number : 5}, 1, 1);

            p._stack.push(1);
            p._stack.push(1);
            p._stack.push(1);
            p._stack.push(1);

            engine._tabPiece.push(p);
            engine._tabPiece.push(q);
            //engine._tabPiece.push(r);

            //console.log("taille liste avant: ", engine._tabPiece.length);
            console.log("contenu avant:  ", JSON.stringify(engine._tabPiece));

            engine._move_piece(p._coordinates,p._stack,p._level,2,q._coordinates);

            //console.log("taille liste après: ", engine._tabPiece.length);
            console.log("contenu après:  ", engine._tabPiece);

            assert.ok(engine._tabPiece.length === 2);
        });


    </script>
</head>
<body><div id="qunit"></div></body>
</html>